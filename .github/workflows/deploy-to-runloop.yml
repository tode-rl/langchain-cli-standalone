name: Deploy to Runloop

on:
  push:
    branches:
      - main
  release:
    types: [published]
  workflow_dispatch:  # Allow manual triggering

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy agent to Runloop
        id: deploy
        uses: runloopai/deploy-agent@main
        with:
          api-key: ${{ secrets.RUNLOOP_API_KEY }}
          source-type: "git"
          git-repository: ${{ github.server_url }}/${{ github.repository }}
          git-ref: ${{ github.ref_name }}
          agent-name: ${{ github.repository }}
          setup-commands: |
            python -m venv .venv && source .venv/bin/activate && pip install -e . && echo 'alias deepagents="/home/user/agent/.venv/bin/deepagents --auto-approve"' >> ~/.bashrc && echo 'alias deepagents-server="/home/user/agent/.venv/bin/deepagents dev --allow-blocking --auto-approve"' >> ~/.bashrc
